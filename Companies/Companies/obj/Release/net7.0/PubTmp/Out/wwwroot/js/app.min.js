var __awaiter=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(n,t){function o(e){try{r(l.next(e))}catch(e){t(e)}}function i(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(o,i)}r((l=l.apply(e,a||[])).next())})};class Ajax{constructor(e,t){this.requestUrl="/ajax/"+e,this.cookies=t,this.xhttp=new XMLHttpRequest}sendRequest(n=null){return __awaiter(this,void 0,void 0,function*(){return new Promise(t=>{try{var e=this.cookies.getCookie("CSRF-TOKEN");this.xhttp.open("POST",this.requestUrl,!0),this.xhttp.onreadystatechange=()=>{4===this.xhttp.readyState&&(200!==this.xhttp.status?t(""):t(this.xhttp.responseText))},this.xhttp.onerror=()=>{console.error("ERROR: ","Bad response"),t("")},this.xhttp.setRequestHeader("X-CSRF-TOKEN",e),null==n?this.xhttp.send():(this.xhttp.setRequestHeader("Content-type","application/json"),this.xhttp.send(JSON.stringify(n)))}catch(e){console.error("ERROR: ",e),t("")}})})}}class Cookies{getCookie(e){var n=e+"=";const t=decodeURIComponent(document.cookie);var o=t.split(";");for(let t=0;t<o.length;t++){let e=o[t];for(;" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(n))return e.substring(n.length,e.length)}return""}setCookie(e,t){const n=new Date;n.setTime(n.getTime()+2592e6),document.cookie=e+"="+encodeURIComponent(t)+";expires="+n.toUTCString()+";path=/;secure"}removeCookie(e){document.cookie=e+"=;Max-Age=-99999999;"}}__awaiter=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(n,t){function o(e){try{r(l.next(e))}catch(e){t(e)}}function i(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(o,i)}r((l=l.apply(e,a||[])).next())})};class Details{constructor(e,t,n){this.cookies=t,this.utilities=e,this.IdCompany=n,this.EmployeeInputFirst=document.getElementById("employee_fisrt"),this.EmployeeInputLast=document.getElementById("employee_last"),this.EmployeeInputTitle=document.getElementById("employee_title"),this.EmployeeInputBirthDate=document.getElementById("employee_date"),this.EmployeeInputPos=document.getElementById("employee_pos");t=document.getElementById("update_history_action"),null!==t&&t.addEventListener("click",()=>__awaiter(this,void 0,void 0,function*(){return yield this.generateHistory()})),e=document.getElementById("update_notes_action"),null!==e&&e.addEventListener("click",()=>__awaiter(this,void 0,void 0,function*(){return yield this.generateNotes()})),n=document.getElementById("update_employees_action"),null!==n&&n.addEventListener("click",()=>__awaiter(this,void 0,void 0,function*(){return yield this.generateEmployees()})),t=document.getElementById("remove_notes_action"),null!==t&&t.addEventListener("click",()=>__awaiter(this,void 0,void 0,function*(){yield this.removeNotes(),yield this.generateNotes()})),e=document.getElementById("remove_employees_action"),null!==e&&e.addEventListener("click",()=>__awaiter(this,void 0,void 0,function*(){yield this.removeEmployees(),yield this.generateEmployees()})),n=document.getElementById("add_notes_action"),null!==n&&n.addEventListener("click",()=>__awaiter(this,void 0,void 0,function*(){return window.open("/docs")})),t=document.getElementById("add_employees_action");null!==t&&t.addEventListener("click",()=>__awaiter(this,void 0,void 0,function*(){return window.open("/docs")}))}startDetailsLogic(){console.log("Start Loading Company: "+this.IdCompany.toString()),this.generateInfo().then(()=>{console.log("-> action Generate Info ok")}).catch(e=>{console.error("-> error: "+e)}),this.generateHistory().then(()=>{console.log("-> action Generate History ok")}).catch(e=>{console.error("-> error: "+e)}),this.generateNotes().then(()=>{console.log("-> action Generate Notes ok")}).catch(e=>{console.error("-> error: "+e)}),this.generateEmployees().then(()=>{console.log("-> action Generate Employees ok")}).catch(e=>{console.error("-> error: "+e)})}generateEmployees(){return __awaiter(this,void 0,void 0,function*(){this.EmployeeInputFirst.value="",this.EmployeeInputLast.value="",this.EmployeeInputTitle.value="",this.EmployeeInputBirthDate.value="",this.EmployeeInputPos.value="";var i=document.getElementById("employees_block");i.innerHTML="";const e=new Ajax("GetEmployees",this.cookies);var t=yield e.sendRequest();if(console.log(t),this.utilities.isEmpty(t))document.location.href="/error";else{const n=JSON.parse(t);var r=0;n.forEach(e=>{var t=document.createElement("tr"),n=(t.id=e.Id,document.createElement("td")),o=document.createElement("td");t.appendChild(n),t.appendChild(o),n.innerText=e.FirstName,o.innerText=e.LastName,t.addEventListener("click",()=>__awaiter(this,void 0,void 0,function*(){t.classList.contains("remove")?(t.classList.remove("remove"),t.setAttribute("style","background: #ffffff;")):(t.classList.add("remove"),t.setAttribute("style","background: #e3e3e3;")),yield this.getInfoEmployee(Number(e.Id))})),i.appendChild(t),0==r&&this.getInfoEmployee(Number(e.Id)),r++})}})}removeEmployees(){return __awaiter(this,void 0,void 0,function*(){var e=document.getElementById("employees_block"),e=Array.from(e.getElementsByClassName("remove")),t=[],e=(e.forEach(e=>{t.push(Number(e.id))}),{ids:t});if(0<t.length){const n=new Ajax("DeleteEmployees",this.cookies);yield n.sendRequest(e)}})}getInfoEmployee(n){return __awaiter(this,void 0,void 0,function*(){var e={id:n};const t=new Ajax("GetEmployee",this.cookies);var e=yield t.sendRequest(e);this.utilities.isEmpty(e)?document.location.href="/error":(e=JSON.parse(e),console.log(e),this.EmployeeInputFirst.value=e.FirstName,this.EmployeeInputLast.value=e.LastName,this.EmployeeInputTitle.value=e.Title,this.EmployeeInputBirthDate.value=e.BirthDate,this.EmployeeInputPos.value=e.Position)})}generateNotes(){return __awaiter(this,void 0,void 0,function*(){var i=document.getElementById("notes_block");i.innerHTML="";const e=new Ajax("GetNotes",this.cookies);var t=yield e.sendRequest();if(this.utilities.isEmpty(t))document.location.href="/error";else{const n=JSON.parse(t);n.forEach(e=>{var t=document.createElement("tr"),n=document.createElement("td"),o=document.createElement("td");t.appendChild(n),t.appendChild(o),n.innerText=e.Id,o.innerText=e.Employee,t.addEventListener("click",()=>__awaiter(this,void 0,void 0,function*(){t.classList.contains("remove")?(t.classList.remove("remove"),t.setAttribute("style","background: #ffffff;")):(t.classList.add("remove"),t.setAttribute("style","background: #e3e3e3;"))})),i.appendChild(t)})}})}removeNotes(){return __awaiter(this,void 0,void 0,function*(){var e=document.getElementById("notes_block"),e=Array.from(e.getElementsByClassName("remove")),t=[],e=(e.forEach(e=>{e=e.children[0].innerHTML;t.push(Number(e))}),{ids:t});if(0<t.length){const n=new Ajax("DeleteNotes",this.cookies);yield n.sendRequest(e)}})}generateHistory(){return __awaiter(this,void 0,void 0,function*(){console.log("Start Loading Orders History Company: "+this.IdCompany.toString());var i=document.getElementById("history_block");i.innerHTML="";const e=new Ajax("GetOrdersHistory",this.cookies);var t=yield e.sendRequest();if(this.utilities.isEmpty(t))document.location.href="/error";else{const n=JSON.parse(t);n.forEach(e=>{var t=document.createElement("tr"),n=document.createElement("td"),o=document.createElement("td");t.appendChild(n),t.appendChild(o),n.innerText=e.OrderDate,o.innerText=e.StoreCity,i.appendChild(t)})}})}generateInfo(){return __awaiter(this,void 0,void 0,function*(){console.log("Start Loading Info Company: "+this.IdCompany.toString());var e=document.getElementById("info_block"),t=document.createElement("label"),n=(t.innerText="ID:",document.createElement("input")),o=(n.type="number",n.setAttribute("readonly",""),document.createElement("label")),i=(o.innerText="Name:",document.createElement("input")),r=(i.type="text",i.setAttribute("readonly",""),document.createElement("label")),a=(r.innerText="Address:",document.createElement("input")),s=(a.type="text",a.setAttribute("readonly",""),document.createElement("label")),l=(s.innerText="City:",document.createElement("input")),d=(l.type="text",l.setAttribute("readonly",""),document.createElement("label")),c=(d.innerText="State:",document.createElement("input")),t=(c.type="text",c.setAttribute("readonly",""),e.appendChild(t),e.appendChild(n),e.appendChild(o),e.appendChild(i),e.appendChild(r),e.appendChild(a),e.appendChild(s),e.appendChild(l),e.appendChild(d),e.appendChild(c),{idCompany:Number(this.IdCompany)});const u=new Ajax("getCompanyInfo",this.cookies);o=yield u.sendRequest(t);this.utilities.isEmpty(o)?document.location.href="/error":(r=JSON.parse(o)).IsValid&&(n.value=r.Id,i.value=r.Name,a.value=r.Address,l.value=r.City,c.value=r.State)})}}class Index{constructor(){console.log("Load Main Page");var e=document.getElementById("add_company_action");console.log(e),e.addEventListener("click",()=>window.open("/docs"))}}window.addEventListener("load",()=>{var e=new Utilities,t=new Cookies;const n=new URL(document.location.href),o=n.pathname.toLowerCase();var i=o.split("/");switch(i[1]){case"":console.log("Index Load"),new Index;break;case"details":{console.log("Details Load");var r=i[2];const a=new Details(e,t,r);a.startDetailsLogic()}}});__awaiter=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(n,t){function o(e){try{r(l.next(e))}catch(e){t(e)}}function i(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(o,i)}r((l=l.apply(e,a||[])).next())})};class Utilities{isEmpty(e){return null==e||""===e}isValidEmail(e){if(this.isEmpty(e))return!1;return/^([a-z0-9_.-])+@[a-z0-9-]+\.([a-z]{2,4}\.)?[a-z]{2,4}$/i.test(e)}doDelay(t){return __awaiter(this,void 0,void 0,function*(){return new Promise(e=>{setTimeout(()=>{e(null)},t)})})}get getWidh(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}get getHeight(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}copyValueToBuffer(e,t){try{var n=t.getBoundingClientRect(),o=window.pageYOffset||document.documentElement.scrollTop,i=navigator.userAgent.match(/ipad|iphone/i);const l=document.createElement("textarea");if(l.readOnly=!0,l.style.top=Math.round(o+n.top)+"px",l.classList.add("text_copy"),l.value=e,document.body.appendChild(l),l.focus(),i){var r=l.contentEditable,a=l.readOnly;l.contentEditable="true",l.readOnly=!1;const d=document.createRange(),c=(d.selectNodeContents(l),window.getSelection());c.removeAllRanges(),c.addRange(d),l.setSelectionRange(0,999999),l.contentEditable=r,l.readOnly=a}else l.select();var s=document.execCommand("copy");return document.body.removeChild(l),s}catch(e){return console.error("Error: ",e),!1}}getCurrentDate(){const e=new Date;var t=e.getDate(),n=e.getMonth()+1;let o="",i=(t<10&&(o="0"),"");return n<10&&(i="0"),""+o+t+`.${i}${n}.`+e.getFullYear()}generateUuid(){var n=(new Date).getTime(),o="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{var t=16*Math.random();return 0<n?(t=(n+t)%16|0,n=Math.floor(n/16)):(t=(o+t)%16|0,o=Math.floor(o/16)),("x"===e?t:3&t|8).toString(16)})}}